{% extends 'base.html' %}

{% block title %}Todo一覧 - {{ username }}{% endblock title %}

{% block content %}
<section class="section">
  <div class="container">
    <div class="level">
      <div class="level-left">
        <h1 class="title">
          <span class="icon">
            <i class="fas fa-list"></i>
          </span>
          Todo一覧
        </h1>
      </div>
      <div class="level-right">
        <a href="{{ reverse(master, 'todo:todo_create', username=username) }}" class="button is-primary">
          <span class="icon">
            <i class="fas fa-plus"></i>
          </span>
          <span>新しいTodo</span>
        </a>
      </div>
    </div>
    
    <!-- フィルター -->
    <div class="box">
      <form method="get">
        <div class="field is-grouped">
          <div class="control">
            <div class="select">
              <select name="status">
                <option value="all" {% if filter_status == 'all' %}selected{% endif %}>すべて</option>
                <option value="pending" {% if filter_status == 'pending' %}selected{% endif %}>未完了</option>
                <option value="completed" {% if filter_status == 'completed' %}selected{% endif %}>完了済み</option>
              </select>
            </div>
          </div>
          <div class="control">
            <div class="select">
              <select name="priority">
                <option value="all" {% if filter_priority == 'all' %}selected{% endif %}>すべての優先度</option>
                <option value="high" {% if filter_priority == 'high' %}selected{% endif %}>高</option>
                <option value="medium" {% if filter_priority == 'medium' %}selected{% endif %}>中</option>
                <option value="low" {% if filter_priority == 'low' %}selected{% endif %}>低</option>
              </select>
            </div>
          </div>
          <div class="control">
            <div class="select">
              <select name="category">
                <option value="all" {% if filter_category == 'all' %}selected{% endif %}>すべてのカテゴリー</option>
                {% for category in categories %}
                <option value="{{ category.sk }}" {% if filter_category == category.sk %}selected{% endif %}>{{ category.name }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="control">
            <button type="submit" class="button is-info">フィルター</button>
          </div>
        </div>
      </form>
    </div>
    
    <!-- Todo一覧 -->
    {% if todos %}
    <div class="box">
      {% for todo in todos %}
      <div class="card mb-4">
        <div class="card-content">
          <div class="level">
            <div class="level-left">
              <div class="level-item">
                <div>
                  <p class="title is-5 {% if todo.completed %}has-text-grey-light{% endif %}">
                    {% if todo.completed %}
                      <span class="icon has-text-success">
                        <i class="fas fa-check"></i>
                      </span>
                    {% endif %}
                    {{ todo.title }}
                  </p>
                  {% if todo.description %}
                  <p class="subtitle is-6 {% if todo.completed %}has-text-grey-light{% endif %}">{{ todo.description }}</p>
                  {% endif %}
                  <div class="tags">
                    {% if todo.priority == 'high' %}
                      <span class="tag is-danger">高優先度</span>
                    {% elif todo.priority == 'medium' %}
                      <span class="tag is-warning">中優先度</span>
                    {% else %}
                      <span class="tag is-info">低優先度</span>
                    {% endif %}
                    
                    {% if todo.completed %}
                      <span class="tag is-success">完了</span>
                    {% else %}
                      <span class="tag is-light">未完了</span>
                    {% endif %}
                    
                    {% for category in categories %}
                      {% if category.sk == todo.category_id %}
                        <span class="tag is-{{ category.color }}">{{ category.name }}</span>
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
            <div class="level-right">
              <div class="level-item">
                <div class="buttons">
                  <a href="{{ reverse(master, 'todo:todo_toggle', username=username, todo_id=todo.sk) }}" 
                     class="button is-small {% if todo.completed %}is-warning{% else %}is-success{% endif %}">
                    {% if todo.completed %}
                      <span class="icon">
                        <i class="fas fa-undo"></i>
                      </span>
                    {% else %}
                      <span class="icon">
                        <i class="fas fa-check"></i>
                      </span>
                    {% endif %}
                  </a>
                  <a href="{{ reverse(master, 'todo:todo_edit', username=username, todo_id=todo.sk) }}" 
                     class="button is-small is-info">
                    <span class="icon">
                      <i class="fas fa-edit"></i>
                    </span>
                  </a>
                  <a href="{{ reverse(master, 'todo:todo_delete', username=username, todo_id=todo.sk) }}" 
                     class="button is-small is-danger"
                     onclick="return confirm('このTodoを削除しますか？')">
                    <span class="icon">
                      <i class="fas fa-trash"></i>
                    </span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="box has-text-centered">
      <p class="title is-4 has-text-grey-light">Todoがありません</p>
      <p class="subtitle is-6 has-text-grey-light">新しいTodoを作成してみましょう</p>
      <a href="{{ reverse(master, 'todo:todo_create', username=username) }}" class="button is-primary">
        <span class="icon">
          <i class="fas fa-plus"></i>
        </span>
        <span>最初のTodoを作成</span>
      </a>
    </div>
    {% endif %}
  </div>
</section>
{% endblock content %}